<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>API · SurvivalAnalysis</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SurvivalAnalysis</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../examples/">Examples</a></li><li class="is-active"><a class="tocitem" href>API</a><ul class="internal"><li><a class="tocitem" href="#Modules"><span>Modules</span></a></li><li><a class="tocitem" href="#Types"><span>Types</span></a></li><li><a class="tocitem" href="#Functions"><span>Functions</span></a></li><li><a class="tocitem" href="#Macros-and-Constants"><span>Macros and Constants</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>API</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>API</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/RaphaelS1/SurvivalAnalysis.jl/blob/main/docs/src/api.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="API"><a class="docs-heading-anchor" href="#API">API</a><a id="API-1"></a><a class="docs-heading-anchor-permalink" href="#API" title="Permalink"></a></h1><h2 id="Modules"><a class="docs-heading-anchor" href="#Modules">Modules</a><a id="Modules-1"></a><a class="docs-heading-anchor-permalink" href="#Modules" title="Permalink"></a></h2><h2 id="Types"><a class="docs-heading-anchor" href="#Types">Types</a><a id="Types-1"></a><a class="docs-heading-anchor-permalink" href="#Types" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="SurvivalAnalysis.ConcordanceWeights" href="#SurvivalAnalysis.ConcordanceWeights"><code>SurvivalAnalysis.ConcordanceWeights</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ConcordanceWeights(S::Int8, G::Int8, tied_preds::Float64 tied_times::Float64)</code></pre><p>Weights used in the <a href="@concordance"><code>concordance</code></a> function. <code>S</code> and <code>G</code> reflect the power applied to the Kaplan-Meier estimates of the survival and censoring distributions of the fitted data used to apply weighting at a given time. For example <code>ConcordanceWeights(1, -2, 0.5, 0.5)</code> will tell the <code>concordance</code> function to multiply concordant pairs at time <code>t</code> by <code>S(t)/G(t)²</code>. <code>tied_preds</code> and <code>tied_times</code> determine how to handle ties in predictions and observed times respectively.</p><p>See <a href="@concordance"><code>concordance</code></a> for full examples.</p><p>Note❗  It is strongly recommended that <code>S ≥ 0</code> and <code>G ≤ 0</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RaphaelS1/SurvivalAnalysis.jl/blob/940a80cd101c8494301db60324bc51539c4ed32b/src/concordance.jl#L1-L14">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurvivalAnalysis.Surv-Tuple{Union{Vector{T}, T} where T&lt;:Number, Union{Vector{T}, T} where T&lt;:Number}" href="#SurvivalAnalysis.Surv-Tuple{Union{Vector{T}, T} where T&lt;:Number, Union{Vector{T}, T} where T&lt;:Number}"><code>SurvivalAnalysis.Surv</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">Surv(start, stop)
Surv(time)
Surv(time, status, type)</code></pre><p>This is the entry point object into survival modelling.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RaphaelS1/SurvivalAnalysis.jl/blob/940a80cd101c8494301db60324bc51539c4ed32b/src/Surv.jl#L31-L36">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurvivalAnalysis.SurvivalModel" href="#SurvivalAnalysis.SurvivalModel"><code>SurvivalAnalysis.SurvivalModel</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">SurvivalModel

Abstract type for all models implemented in, or extending, this package. Type &#39;inherits&#39;</code></pre><p>from JuliaStats.StatisticalModel to enable formula fitting and predicting interface.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RaphaelS1/SurvivalAnalysis.jl/blob/940a80cd101c8494301db60324bc51539c4ed32b/src/SurvivalModel.jl#L1-L6">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurvivalAnalysis.SurvivalPrediction-Union{Tuple{}, Tuple{T}} where T&lt;:Number" href="#SurvivalAnalysis.SurvivalPrediction-Union{Tuple{}, Tuple{T}} where T&lt;:Number"><code>SurvivalAnalysis.SurvivalPrediction</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">SurvivalPrediction(;
    distr::Union{Nothing, Vector{&lt;:Distribution}} = nothing,
    lp::Union{Nothing, Vector{T}}  = nothing,
    crank::Union{Nothing, Vector{T}} = nothing,
    time::Union{Nothing, Vector{T}} = nothing,
    fit_times::Union{Nothing, Vector{T}} = nothing,
    survival_matrix::Union{Matrix{T}, Nothing} = nothing
    ) where {T&lt;:Number}</code></pre><p>Survival models can make multiple types of predictions including:</p><ul><li><code>distr</code> - A survival time distribution (implemented with <code>Distributions.jl</code>)</li><li><code>lp</code> - A linear predictor (usually Xβ, i.e. covariates * fitted coefficients)</li><li><code>crank</code> - A generic continuous relative risk ranking</li><li><code>time</code> - A survival time</li><li><code>survival_matrix</code> - A matrix of predicted survival probabilities where rows are</li></ul><p>observations and columns are fitted survival times corresponding to <code>fit_times</code>.</p><p>These predictions can only exist in a finite number of combinations so they are aggregated in types within this package (and automatically determined within this function):</p><ul><li>DeterministicSurvivalPrediction(lp, crank, time)</li><li>DiscreteSurvivalPrediction(distr, lp, crank, time, survival_matrix)</li><li>ContinuousSurvivalPrediction(distr, lp, crank, time)</li></ul><p>Absolutely no transformations take require assumptions take place within this function but it does transform <code>survival_matrix</code> to a <code>Distributions.DiscreteNonParametric</code> and vice versa.</p><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; SurvivalPrediction(time = randn(5)); # DeterministicSurvivalPrediction

julia&gt; SurvivalPrediction(fit_times = randn(5), survival_matrix = randn((2, 5))); # DiscreteSurvivalPrediction

julia&gt; SurvivalPrediction(distr = fill(Exponential(), 2)); # ContinuousSurvivalPrediction</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RaphaelS1/SurvivalAnalysis.jl/blob/940a80cd101c8494301db60324bc51539c4ed32b/src/SurvivalPrediction.jl#L24-L62">source</a></section></article><h2 id="Functions"><a class="docs-heading-anchor" href="#Functions">Functions</a><a id="Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Functions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="RecipesBase.apply_recipe" href="#RecipesBase.apply_recipe"><code>RecipesBase.apply_recipe</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">plot(npe::SurvivalEstimator, plot_confint::Bool = true; level = 0.95)
plot(npe::StatsModels.TableStatisticalModel{KaplanMeier, Matrix{Float64}},
    plot_confint::Bool = true; level = 0.95)

Recipe for plotting fitted non-parametric estimators, `npe`. If `plot_confint` then
confidence intervals also plotted at a `level`% confidence level.

# Examples
```jldoctest
julia&gt; using Plots

julia&gt; data = DataFrame(t = randn(10), d = [trues(5)..., falses(5)...]);

julia&gt; plot(kaplan_meier(@formula(Srv(t, d) ~ 1), data));

julia&gt; plot(nelson_aalen(@formula(Srv(t, d) ~ 1), data).model);
```</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RaphaelS1/SurvivalAnalysis.jl/blob/940a80cd101c8494301db60324bc51539c4ed32b/src/plot_survivalestimator.jl#L1-L19">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurvivalAnalysis.Srv" href="#SurvivalAnalysis.Srv"><code>SurvivalAnalysis.Srv</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">Srv(T::Symbol, Δ::Symbol, type::Int = 1)

Create a `SurvTerm` object for internal use for fitting models. Arguments, `T` and `Δ`
should be a reference to the name of the time and status variables in a `DataFrame`
respectively. `type` should be `1` (or omitted) for right-censoring or `-1`
for left-censoring.

# Examples
```jldoctest
julia&gt; using DataFrames

julia&gt; data = DataFrame(t = [1, 2, 3], d = [1, 0, 0])

julia&gt; @formula(Srv(t, d) ~ 1)
FormulaTerm
Response:
(t,d)-&gt;Srv(t, d)
Predictors:
1

julia&gt; Srv(t, d, -1)
Response:
(t,d)-&gt;Srv(t, d, -1)
Predictors:
1
```</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RaphaelS1/SurvivalAnalysis.jl/blob/940a80cd101c8494301db60324bc51539c4ed32b/src/SurvTerm.jl#L13-L40">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurvivalAnalysis.concordance" href="#SurvivalAnalysis.concordance"><code>SurvivalAnalysis.concordance</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">concordance(
    truth::OneSidedSurv, prediction::Vector{&lt;:Number}, weights::Union{Symbol, ConcordanceWeights};
    tied_preds=0.5, tied_times=0, cutoff=nothing, train::OneSidedSurv=nothing, rev=false
)
cindex(
    truth::OneSidedSurv, prediction::Vector{&lt;:Number}, weights::Union{Symbol, ConcordanceWeights};
    tied_preds=0.5, tied_times=0, cutoff=nothing, train::OneSidedSurv=nothing, rev=false
)</code></pre><p>Generic function to call any concordance index method. Concordance is a measure of discrimination which evaluates if a prediction is concordant with the truth, i.e. let Tᵢ,Tⱼ be the true survival times, <code>truth</code>, for observations <code>i</code> and <code>j</code> and let  ϕᵢ, ϕⱼ be predictions, <code>prediction</code>, then these are concordant if <span>$ϕᵢ &gt; ϕⱼ ⟺ Tᵢ &gt; Tⱼ$</span>.</p><p>In survival analysis the generic C-index is defined as follows</p><p class="math-container">\[C = \frac{\sum_{i≠j} W(tᵢ)I(tᵢ &lt; tⱼ, yᵢ &lt; yⱼ, tᵢ &lt; τ)δᵢ}{W(tᵢ)I(tᵢ &lt; tⱼ, tᵢ &lt; τ)δᵢ}\]</p><p>where <code>tᵢ,tⱼ</code> are true survival times, <code>yᵢ,yⱼ</code> are predictions, <code>τ</code> is a cutoff time used to ensure stability even when censoring is high, <code>δᵢ</code> is the censoring indicator and <code>W</code> is a weighting function determined by <code>weights</code> as follows:</p><pre><code class="nohighlight hljs">* `:I` or `:Harrell` - Harrell&#39;s C - ``W(tᵢ) = 1``
* `:G2` or `:Uno` - Uno&#39;s C - ``W(tᵢ) = 1/G(tᵢ)``
* `:SG` or `:Schemper` - Schemper&#39;s C - ``W(tᵢ) = S(tᵢ)/G(tᵢ)``
* `:S` or `:Peto` - Peto-Wilcoxon&#39;s C - ``W(tᵢ) = S(tᵢ)``</code></pre><p>where <code>S(tᵢ)</code> and <code>G(tᵢ)</code> are respectively the Kaplan-Meier estimates of the survival and censoring distributions of the training data at time <code>tᵢ</code>. For any other combination of weights pass a <a href="@ConcordanceWeights"><code>ConcordanceWeights</code></a> object to <code>weights</code>. Note❗ If training data is not provided to <code>train</code> then <code>truth</code> is used to estimate <code>S</code> and <code>G</code> but it is strongly recommended to provide the training data if possibe.</p><p>We also include an implementation of Gönen-Heller&#39;s C with <code>weights = :GH</code> or <code>:Gonen</code>. Note❗ this is actually a very different method from the others and calculates concordance for predictions from a Cox PH model only. We may move this to its own function in the future to avoid misuse.</p><p>There is open debate about how to handle ties when calculating the concordance. Ties can occur in predictions and in the observed survival times. The defaults here <code>tied_preds=0.5</code> and <code>tied_times=0</code> are set as these seem to be the most common but they can be changed. Note❗ If you pass a <a href="@ConcordanceWeights"><code>ConcordanceWeights</code></a> object then the tied weights specified in this will take priority.</p><p>Note❗ For predictions from PH models or any model where the prediction represents a relative risk then a higher value of ϕ implies a higher risk of event which will result in a <em>lower</em> survival time. In this case a prediction is concordant with the survival time if <span>$ϕᵢ &lt; ϕⱼ ⟺ Tᵢ &gt; Tⱼ$</span>. To do this within the function just set <code>rev=true</code>.</p><pre><code class="language-julia-repl hljs">julia&gt; T = [1.0,0.1,pi,0.9,0.4,20,1,5,9,2.5];

julia&gt; ϕ = [0.1,0.2,0.1,0.9,0.25,exp(2),8,log(9),2,8];

julia&gt; Δ = [true,true,false,true,true,false,true,false,true,true];

julia&gt; Y = Surv(T, Δ, :r);

julia&gt; train = Surv([3,3,9,12,2,1,8,4,10,8], Δ, :r);

julia&gt; concordance(Y, ϕ, cutoff = threshold_risk(Y, 0.8)) # Harrell&#39;s C cutoff when 80% data is censored or dead
SurvivalAnalysis.Concordance

Harrell&#39;s C = 0.6153846153846154

Cutoff: T ≤ 9.0
Counts:
 Pairs  Comparable  Concordant  Disconcordant
    90          39          23             14
Weights:
 IPCW  Tied preds  Tied times
    1         0.5         0.0
Ties:
 Times  Preds  Both
     1      2     0
Weighted calculation:
 Numerator  Denominator         C
      24.0         39.0  0.615385

julia&gt; concordance(Y, ϕ, :Uno, train=train) # Uno&#39;s C
SurvivalAnalysis.Concordance

Uno&#39;s C = 0.6221374045801525

Cutoff: T ≤ 20.0
Counts:
 Pairs  Comparable  Concordant  Disconcordant
    90          39          23             14
Weights:
 IPCW  Tied preds  Tied times
 1/G²         0.5         0.0
Ties:
 Times  Preds  Both
     1      2     0
Weighted calculation:
 Numerator  Denominator         C
   28.1728       45.284  0.622137

julia&gt; cindex(Y, ϕ, ConcordanceWeights(5, -3, 0.5, 0.5, &quot;Silly Weights&quot;); train=train) # Custom weights
SurvivalAnalysis.Concordance

Silly Weights C = 0.6070334788405888

Cutoff: T ≤ 20.0
Counts:
 Pairs  Comparable  Concordant  Disconcordant
    90          40          23             14
Weights:
  IPCW  Tied preds  Tied times
 S⁵/G³         0.5         0.5
Ties:
 Times  Preds  Both
     1      2     0
Weighted calculation:
 Numerator  Denominator         C
   25.6265       42.216  0.607033</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RaphaelS1/SurvivalAnalysis.jl/blob/940a80cd101c8494301db60324bc51539c4ed32b/src/concordance.jl#L75-L195">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurvivalAnalysis.cum_hazard-Tuple{UnivariateDistribution{S} where S&lt;:ValueSupport, Real}" href="#SurvivalAnalysis.cum_hazard-Tuple{UnivariateDistribution{S} where S&lt;:ValueSupport, Real}"><code>SurvivalAnalysis.cum_hazard</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">cum_hazard(d::UnivariateDistribution, x::Real)
Hₜ(d::UnivariateDistribution, x::Real)</code></pre><p>Compute the cumulative hazard function of distribution <code>d</code> at point <code>x</code>.</p><p>The cumulative hazard function for random variable <span>$t$</span> is defined as</p><p class="math-container">\[H_t(x) = \int^x_0 h_t(u) du = -log(S_t(x))\]</p><p>where <span>$hₜ$</span> is the hazard function of <span>$t$</span> and <span>$Sₜ$</span> is the survival function of <span>$t$</span>.</p><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; using Distributions

julia&gt; cum_hazard(Binomial(5, 0.5), 3)
1.6739764335716711</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RaphaelS1/SurvivalAnalysis.jl/blob/940a80cd101c8494301db60324bc51539c4ed32b/src/tools.jl#L28-L49">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SurvivalAnalysis.hazard-Tuple{UnivariateDistribution{S} where S&lt;:ValueSupport, Real}" href="#SurvivalAnalysis.hazard-Tuple{UnivariateDistribution{S} where S&lt;:ValueSupport, Real}"><code>SurvivalAnalysis.hazard</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">hazard(d::UnivariateDistribution, x::Real)
hₜ(d::UnivariateDistribution, x::Real)</code></pre><p>Compute the hazard function of distribution <code>d</code> at point <code>x</code>.</p><p>The hazard function for random variable <span>$t$</span> is defined as</p><p class="math-container">\[h_t(x) = \frac{f_t(x)}{S_t(x)}\]</p><p>where <span>$fₜ$</span> is the pdf of <span>$t$</span> and <span>$Sₜ$</span> is the survival function of <span>$t$</span>.</p><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; using Distributions

julia&gt; hazard(Binomial(5, 0.5), 3)
1.6666666666666679</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RaphaelS1/SurvivalAnalysis.jl/blob/940a80cd101c8494301db60324bc51539c4ed32b/src/tools.jl#L4-L25">source</a></section></article><h2 id="Macros-and-Constants"><a class="docs-heading-anchor" href="#Macros-and-Constants">Macros and Constants</a><a id="Macros-and-Constants-1"></a><a class="docs-heading-anchor-permalink" href="#Macros-and-Constants" title="Permalink"></a></h2></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../examples/">« Examples</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Saturday 27 August 2022 07:17">Saturday 27 August 2022</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
